# Antigravity Prototype 003 仕様書

## プロジェクト概要
『Antigravity Prototype 003』は、2Dトップダウン型のアクションシューティングゲームのプロトタイプです。
マルチプレイ（専用サーバー権限）を前提としており、迫りくる敵（ウェーブ）を複数のプレイヤーで撃退しつつ、アイテムを収集・納品して基地やプレイヤーを強化していくシステムを備えています。

## アーキテクチャ構成
*   **ゲームエンジン**: Godot 4.6 (GDScript)
*   **通信方式**: ENet (ネイティブ) / WebSocket (Webエクスポート用)
*   **サーバー主導 (Server Authoritative)**: チート対策と永続化のため、データ管理やステータス変更の権限は全てサーバー側(`PlayerDataManager.gd`等)に集約しています。
*   **専用サーバー (Headless)**: ホストはプレイ画面を持たず常時起動する「専用ロビー」として機能し、全プレイヤーが退出してもエラーなく待機し続けます。

## 主要機能・ゲームサイクル
1.  **タイトル・接続 (`Title.tscn`)**
    *   プレイヤーは「Start Game」から専用サーバーへ接続します。
    *   初回起動時に生成されるUUID (`client_token.json`) を使って継続的な認証を行います。
2.  **ホーム・基地 (`Home.tscn`)**
    *   **Laboratory (研究所)**: キャリー上限や最大HPをサーバーにリクエストし、資材（Materials）を消費して強化します。
    *   **Armory (武器庫)**: アンロックされた武器を選択・装備できます。
    *   「To Battle」に触れることで、プレイヤーの準備完了をサーバーに通知し、全員完了でメインゲームへ遷移します。
3.  **メインバトル (`main.tscn`)**
    *   **ウェーブ・敵システム**: 一定時間ごとにウェーブが進行し、通常(Scout)、耐久型(Tank)、遠距離型(Shooter)などの多様な敵がスポーンします。
    *   **収集と納品 (Scavenging)**: 倒した敵が落とすスクラップ（資材）や、フィールドの「Weapon Box」を拾い上げ、中央のBaseへ持ち帰ることでスコアや新規武器を獲得します。
    *   **戦闘 (Combat)**: ショットガン、貫通弾などの武器の使い分け、リロード管理などが要求されます。
4.  **リザルト (`Result.tscn`)**
    *   得られたスコアに応じた資材（Materials）の獲得演出が表示され、その後再びホームへ戻るループとなります。

## データ・状態の管理
*   `save_data.json` のような従来のローカルセーブは抑止されています。
*   `PlayerDataManager.gd` がローカルの `my_token` を介してサーバーへRPC要求を送り、最新のステータス（キャッシュ）を受け取ります。
*   サーバーは `user://server_data.json` へ全プレイヤーの進行状況を60秒ごとに自動保存（オートセーブ）します。

## オーディオ・演出
*   `AudioManager.gd` (Autoload) によって、BGMやSEが一元管理されています。
*   プレイヤーが上方（Y軸マイナス方向）へ進む・あるいはゲームが進行するにつれ、BGMのピッチがシームレスに上昇したりドラムトラックが追加されたりするインタラクティブ性があります。
*   ヒットストップ（白フラッシュ）、ダメージ数字のアニメーションなど「ゲームフィール（手触り感）」を向上させるPolishが反映されています。
